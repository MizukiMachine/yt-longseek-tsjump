# Chrome拡張「YouTube 長時間シーク & 現地時刻ジャンプ」要件&仕様

## 1. 目的
YouTube ライブ配信（特に24時間配信）や長尺動画で、長時間単位の巻き戻し/早送りや、現地（オランダ）時刻を指定してその瞬間へジャンプできるようにする

対象例：DVR有効live配信


## 2. 機能

### (A) 長時間シーク（早送り・巻き戻し）
- デフォルト：±10分、±60分（Chrome拡張機能4コマンド制限のため）
- キーボードショートカットで実行
  - (実装済み)
    - Alt+Shift+Q → -60分
    - Alt+Shift+A → -10分
    - Alt+Shift+W → +60分
    - Alt+Shift+S → +10分
  - ポイント
    - Q/A = 戻る系、W/S = 進む系でペア配置
    - Chrome拡張機能の4コマンド制限により±30分は除外
  - ユーザーは `chrome://extensions/shortcuts` で変更可能（手動設定が必要）
- 動作範囲は `video.seekable.start()` ～ `video.seekable.end()` にクランプ
- DVR無効時は巻き戻し不可、ライブエッジ（最新位置）より先へは進めない
- 広告中は動作しない（通知表示）



### (B) 「現地時刻ジャンプ」機能
- 入力欄に **オランダ（Europe/Amsterdam）のローカル時刻**を入力
  - 対応形式：`HH:mm`、`HH:mm:ss`（コロン区切り）
  - 将来対応予定：`HHmm`、`HHmmss`（コロンなし）
- 実行すると、現地時刻に対応する再生位置へジャンプ
- **DST（サマータイム）対応**：タイムゾーン変換は `Europe/Amsterdam` 基準で計算
- 計算式（双方向計算対応）
  1. 現在のライブエッジのオランダ時刻 = `NL_now`
  2. 入力値のオランダ時刻 = `NL_input`
  3. 差分 Δ = 最短時間差を自動選択
     - 前方向: `NL_input - NL_now`
     - 後方向: 上記 ± 24時間
     - より短い時間差を採用（例：現在14:00で06:00入力→8時間戻る）
  4. `currentTime + Δ` にシーク（範囲外ならクランプ）
- **日付解決ルール**
  - 双方向計算により最適な時刻を自動選択（既定）
  - オプションで「Today / Yesterday」手動切替も可能
- DVR範囲外なら、範囲端に丸めて通知


## 3. 初期開発方針（タイムゾーン仕様）
- 初期はオランダ固定で開発
  - 実装・説明がシンプルになり、リリースまでの速度が上がる
- 要望や利用状況を見て、将来的にタイムゾーン選択機能を追加可能
  - 他国の配信やイベントにも対応し、汎用化できる
  - タイムゾーン一覧・DST対応を拡張する設計を視野に入れる


## 4. オプション設定
- 長時間シークの分数（自由設定）
- 「現地時刻ジャンプ」機能の既定動作
  - 未来入力時の自動「昨日」切替オン/オフ
  - 入力形式（HH:mm、HH:mm:ss、HHmm、HHmmss対応予定）


## 5. 対象サイトと権限（最小権限設計）
```json
"permissions": ["commands", "storage", "scripting", "activeTab"],
"host_permissions": [
  "https://www.youtube.com/*",
  "https://www.youtube-nocookie.com/*"
]
```

* `<all_urls>` は使わない
* 必要な場合のみ追加（例：モバイル版YouTube、埋め込みプレイヤー）


## 6. セキュリティ／審査対策

* **CSP準拠**

  * JSは外部ファイル化（インライン禁止、`eval`禁止）
  * ライブラリは同梱（CDN直読み禁止）
* 外部API・データ送信なし（完全ローカル動作）
* 広告スキップやDVR無効回避など、YouTubeの制限を迂回する機能は実装しない
* ストア説明に「YouTube™ 非公式ツール」であることを明記


## 7. 動作確認チェックリスト

1. VODでの±シーク（端でクランプされる）
2. DVR有効ライブ：巻き戻し可／エッジ超え不可
3. DVR無効ライブ：巻き戻し不可、エッジ超え不可
4. 現地時刻ジャンプ：

   * オランダ時刻で双方向計算による最適な差分選択
   * DSTの日も正しい位置に移動
   * 自動的に最短時間差を選択（例：14:00→06:00は8時間戻る）
   * DVR範囲外は端に丸め通知
5. 広告中は動作せず通知
6. 入力中やIME変換中はショートカット無効化


## 8. 配布方法

1. ローカル開発 → `chrome://extensions` に読み込み
2. 動作確認後、ZIP化してChrome Web Storeへアップロード
3. 公開形態：

   * **Public**：全員に検索・インストール可能
   * **Unlisted**：URLを知っている人だけ
4. 更新時はバージョン番号を上げて再アップロード（ユーザーは自動更新）

